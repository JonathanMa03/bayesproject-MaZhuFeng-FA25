---
title: "Posterior Summary"
author: "Jonathan Ma"
date: "`r Sys.Date()`"
output:
  word_document:
    toc: true
    number_sections: true
---

\newpage

# Diagnostics

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=4)
breast <- readRDS("../R/breast_model.rds")
seer_df2 <- read.csv("../data/clean/seer_df2.csv", sep = ",", header = TRUE, stringsAsFactors = TRUE)
library(bayesplot)
library(rstan)
```

Model is loaded from an RDS object in the repository, so you dont have to wait a long time for it to run.

## Convergence and Efficienct

```{r Summary}
summary(breast)
```

We see no scale reduction (Rhat=1.0 in all cases) and ESS are all sufficiently large, and 1 divergent transition, but its small enough to be due to chance.

## VIF

We check VIF, and confirm all values are reasonable, being around 1.

```{r VIF}
car::vif(lm(latestage ~ age + sex + raceth + grade + size_z + year_z + marry, data = seer_df2))
```

## Posterior Draws

Checking Posterior Draws

```{r PP Draws, echo=TRUE}
pp_check(breast, ndraws = 100)
```

The graph displays the posterior predictive distribution, comparing the observed data (y, in dark blue) with replicated data generated from the model (y_rep, in light blue). The alignment between the two curves indicates that the model effectively captures the underlying data-generating process. Notably, the U-shaped pattern suggests a bimodal distribution of predicted probabilities, with concentrations near 0 and 1 and very few observations around 0.5, indicating high model certainty in classification. The tight overlay of y_rep lines around the observed y line suggests good model fit and calibration.